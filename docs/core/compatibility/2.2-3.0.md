---
title: Breaking changes, version 2.2 to 3.0 - .NET Core
description: Lists the breaking changes from version 2.2 to version 3.0 of .NET Core, ASP.NET Core, and EF Core.
ms.date: "10/08/2019"
author: "rpetrusha"
ms.author: "ronpet"
---
# Breaking changes for migration from Version 2.2 to 3.0

> [!IMPORTANT]
> This article is under construction. This is not a complete list of .NET Core breaking changes. For more information on .NET Core breaking changes, you can examine individual [breaking changes issues](https://github.com/dotnet/docs/issues?q=is%3Aissue+is%3Aopen+label%3Abreaking-change) in the dotnet/docs repository on GitHub.

If you're migrating from version 2.2 to version 3.0 of .NET Core, ASP.NET Core, or EF Core, review the following topics for breaking changes that may affect your app:

## CoreFx

[!INCLUDE[APIs that report version now report product and not file version](~/includes/core-changes/corefx/version-information-changes.md)]

***

[!INCLUDE[Custom EncoderFallbackBuffer instances cannot fall back recursively](~/includes/core-changes/corefx/custom-encoderfallbackbuffer-cannot-be-recursive.md)]

***

[!INCLUDE[Floating point formatting and parsing behavior changes](~/includes/core-changes/corefx/floating-point-changes.md)]

***

[!INCLUDE[Floating-point parsing operations no longer fail or throw an OverflowException](~/includes/core-changes/corefx/floating-point-parsing-does-not-overflow.md)]

***

[!INCLUDE[InvalidAsynchronousStateException moved to another assembly](~/includes/core-changes/corefx/move-invalidasynchronousstateexception.md)]

***

[!INCLUDE[NET Core 3.0 follows Unicode best practices when replacing ill-formed UTF-8 byte sequences](~/includes/core-changes/corefx/net-core-3-0-follows-unicode-utf8-best-practices.md)]

***

[!INCLUDE[TypeDescriptionProviderAttribute moved to another assembly](~/includes/core-changes/corefx/move-typedescriptionproviderattribute.md)]

***

[!INCLUDE[ZipArchiveEntry no longer handles archives with inconsistent entry sizes](~/includes/core-changes/corefx/ziparchiveentry-and-inconsistent-entry-sizes.md)]

## Cryptography

[!INCLUDE[EnvelopedCms defaults to AES-256 encryption](~/includes/core-changes/cryptography/envelopedcms-defaults-to-aes256.md)]

***

[!INCLUDE[Minimum size for RSAOpenSsl key generation has increased](~/includes/core-changes/cryptography/minimum-rsaopenssl-key-size-change.md)]

***

[!INCLUDE[.NET Core 3.0 prefers OpenSSL 1.1.x to OpenSSL 1.0.x](~/includes/core-changes/cryptography/net-core-3-0-prefers-openssl-1-1-x.md)]

## Globalization

[!INCLUDE["C" locale maps to the invariant locale](~/includes/core-changes/globalization/c-locale-maps-to-invariant-locale.md)]

## Networking

[!INCLUDE[Default value of HttpRequestMessage.Version changed to 1.1](~/includes/core-changes/networking/httprequestmessage-version-change.md)]

## Visual Basic

[!INCLUDE[vbNewLine is obsolete](~/includes/core-changes/visualbasic/vbnewline-is-obsolete.md)]

## ASP.NET Core

### AddAuthorization overload lives in a different assembly

We renamed the core `AddAuthorization` methods that used to live in `Microsoft.AspNetCore.Authorization` to be `AddAuthorizationCore`. The old `AddAuthorization` methods still exist, but are in the `Microsoft.AspNetCore.Authorization.Policy` package instead. Apps that are using both should see no impact. Apps that weren't using the policy package will need to switch to using `AddAuthorizationCore`.

#### Version introduced

3.0

#### Old behavior

`AddAuthorization` methods existed in `Microsoft.AspNetCore.Authorization`.

#### New behavior

`AddAuthorization` methods exist in `Microsoft.AspNetCore.Authorization.Policy`. `AddAuthorizationCore` is the new name for the old methods.

#### Reason for change

We wanted the better `AddAuthorization` name to add all of the common services needed for authorization. We decided to take over the old name in 3.0.

#### Recommended action

Either add a reference to `Microsoft.AspNetCore.Authorization.Policy` or use `AddAuthorizationCore` instead.

#### Category

ASP.NET Core

#### Affected APIs

[AddAuthorization(Action<AuthorizationOptions>)](/dotnet/api/microsoft.extensions.dependencyinjection.authorizationservicecollectionextensions.addauthorization?view=aspnetcore-2.2#Microsoft_Extensions_DependencyInjection_AuthorizationServiceCollectionExtensions_AddAuthorization_Microsoft_Extensions_DependencyInjection_IServiceCollection_System_Action_Microsoft_AspNetCore_Authorization_AuthorizationOptions__)

***

### Removed Microsoft.AspNetCore.All shared framework

Earlier this year, we announced the `Microsoft.AspNetCore.App` metapackage (see https://github.com/aspnet/Announcements/issues/287). That announcement said:

> The existing `Microsoft.AspNetCore.All` meta-package will continue to be made available throughout the 2.x lifecycle, but **we recommend customers move to the new Microsoft.AspNetCore.App meta-package** and then add individual references to any of the removed packages if their app requires it.

See [our documentation for details](/aspnet/core/fundamentals/metapackage?view=aspnetcore-2.1#migrating-from-microsoftaspnetcoreall-to-microsoftaspnetcoreapp) on how to migrate from `Microsoft.AspNetCore.All` to `Microsoft.AspNetCore.App`.

As of ASP.NET Core 3.0, we no longer produce the `Microsoft.AspNetCore.All` metapackage and the matching `Microsoft.AspNetCore.All` shared framework in the 3.0 nightly builds.

This package will still be available in ASP.NET Core 2.2 and will continue to receive servicing updates in ASP.NET Core 2.1.

#### Version introduced

3.0

#### Old behavior

Apps could use the `Microsoft.AspNetCore.All` metapackage to target the `Microsoft.AspNetCore.All` shared framework on .NET Core.

#### New behavior

There is no `Microsoft.AspNetCore.All` shared framework as part of .NET Core 3.0.

#### Reason for change

As [previously announced](https://github.com/aspnet/Announcements/issues/287), the `Microsoft.AspNetCore.All` included a large number of external dependencies.

#### Recommended action

Migrate your app to use the `Microsoft.AspNetCore.App` framework. Components that used to be available in `Microsoft.AspNetCore.All` are **still available on NuGet** and will now be deployed with your app instead of being included in the framework.

#### Category

ASP.NET Core

#### Affected APIs

Any API that was only present in the `Microsoft.AspNetCore.All` framework.

***

### Deprecated ASP.NET Core MvcPrecompilation tool

In ASP.NET Core 1.1, we introduced the `Microsoft.AspNetCore.Mvc.Razor.ViewCompilation` (MVC precompilation tool) package that added support for publish time compilation of Razor files (*.cshtml* files). Starting in ASP.NET Core 2.1, we introduced the [Razor SDK](/aspnet/core/razor-pages/sdk?view=aspnetcore-2.1) that expanded on the features of the precompilation tool by adding support for build and publish time of Razor files. The SDK allows for verifying the correctness of cshtml files at build time while also improving on startup time for apps. The Razor SDK is on by default and no gesture is required to start using it.

In 3.0, we removed the earlier MVC precompilation tool. Earlier versions of the package will continue receiving important bug and security fixes as part of our patch release. 

For users of ASP.NET Core 2.1 or later, we recommend migrating to the Razor SDK if you haven't already. If you're using the precompilation tool and are unable to migrate to the Razor SDK because of bugs or missing features, file an issue at https://github.com/aspnet/Razor/issues.

#### Version introduced

3.0

#### Old behavior

The `Microsoft.AspNetCore.Mvc.Razor.ViewCompilation` was used to pre-compile MVC Razor Views.

#### New behavior

The Razor SDK natively supports this functionality. The `Microsoft.AspNetCore.Mvc.Razor.ViewCompilation` is no longer updated.

#### Reason for change

The Razor SDK provides more functionality and allows for verifying the correctness of cshtml files at build time while also improving on startup time for apps.

#### Recommended action

Update to use the native support for precompilation in the [Razor SDK](/aspnet/core/razor-pages/sdk?view=aspnetcore-3.0).

#### Category

ASP.NET Core

#### Affected APIs

Not detectable via API analysis

***

### Removed Microsoft.AspNetCore.Mvc.WebApiCompatShim

The `Microsoft.AspNetCore.Mvc.WebApiCompatShim` (WebApiCompatShim) package provides partial compatibility in ASP.NET Core with ASP.NET 4.x Web API 2 to simplify migrating existing Web API implementations to ASP.NET Core. However, apps using the WebApiCompatShim don't benefit from the API-related features shipping in recent ASP.NET Core releases, such as improved Open API specification generation, standardized error handling, and client code generation. To better focus our API efforts in 3.0, we plan to remove WebApiCompatShim. We recommend that existing apps using the WebApiCompatShim migrate to the newer `[ApiController]` model.

#### Version introduced

3.0

#### Old behavior

The `Microsoft.AspNetCore.Mvc.WebApiCompatShim` package was available.

#### New behavior

The `Microsoft.AspNetCore.Mvc.WebApiCompatShim` package is **no longer** available.

#### Reason for change

The Web API compatibility shim was a migration tool and restricts user access to new functionality added in ASP.NET Core.

#### Recommended action

Remove usage of this shim and migrate directly to the similar functionality in ASP.NET Core itself.

#### Category

ASP.NET Core

#### Affected APIs

All APIs in the `Microsoft.AspNetCore.Mvc.WebApiCompatShim` package

***

### ASP.NET Core 3.0 only runs on .NET Core

.NET Framework will get less of the new platform and language features that come to .NET Core moving forward. This is because of the in-place update nature of .NET Framework and the desire to limit changes there that might break existing apps. To ensure ASP.NET Core can fully leverage the improvements coming to .NET Core moving forward, ASP.NET Core will only run on .NET Core starting from 3.0. Moving forward, you can think of ASP.NET Core as being part of .NET Core.

Customers using ASP.NET Core on .NET Framework today can continue to do so in a fully supported fashion using the [2.1 LTS release][2.1-lts]. Support and servicing for 2.1 will continue until at least August 21, 2021 (three years after its declaration as an LTS release) in accordance with the [.NET Support Policy](https://www.microsoft.com/net/platform/support-policy). In addition, support for ASP.NET Core 2.1 packages **on .NET Framework** will extend indefinitely, similar to the [servicing policy for other package-based ASP.NET frameworks](https://dotnet.microsoft.com/platform/support/policy/aspnet).

For more information about porting from .NET Framework to .NET Core, see our documentation on [Porting to .NET Core.](/dotnet/core/porting/).

`Microsoft.Extensions` packages (such as logging, dependency injection, and configuration) and Entity Framework Core aren't affected. They'll continue to support .NET Standard.

For more information on the motivation for this change, see [the original blog post][aspnet-blog].

[2.1-lts]: https://www.microsoft.com/net/download/dotnet-core/2.1
[dotnet-blog]: https://blogs.msdn.microsoft.com/dotnet/2018/10/04/update-on-net-core-3-0-and-net-framework-4-8/
[aspnet-blog]: https://blogs.msdn.microsoft.com/webdev/2018/10/29/a-first-look-at-changes-coming-in-asp-net-core-3-0
[discussion]: https://github.com/aspnet/AspNetCore/issues/3753

#### Version introduced

3.0

#### Old behavior

ASP.NET Core apps could run on either .NET Core or .NET Framework.

#### New behavior

ASP.NET Core apps can only be run on .NET Core.

#### Reason for change

.NET Framework will receive less of the new platform and language features that come to .NET Core moving forward, due to the in-place update nature of .NET Framework and the desire to limit changes there that might break existing apps. To ensure ASP.NET Core can fully leverage the improvements coming to .NET Core moving forward, ASP.NET Core will only run on .NET Core.

#### Recommended action

- Keep your app on ASP.NET Core 2.1
- Migrate your app and dependencies to .NET Core

#### Category

ASP.NET Core

#### Affected APIs

Not detectable via API analysis

***

### Breaking changes to Microsoft.AspNetCore.App in 3.0

Starting in ASP.NET Core 3.0, the ASP.NET Core shared framework (`Microsoft.AspNetCore.App`) will only contain first-party assemblies that are fully developed, supported, and serviceable by Microsoft. Think of this as constituting the ASP.NET Core "platform." It will be fully [source buildable by anybody via GitHub](https://github.com/dotnet/source-build) and will continue to bring all the existing benefits of .NET Core shared frameworks to your apps. Some benefits include smaller deployment size, centralized patching, and faster startup time. 

As part of this change, some notable breaking changes will be made in `Microsoft.AspNetCore.App`.

#### Version introduced

3.0

#### Old behavior

Projects referenced `Microsoft.AspNetCore.App` via a `<PackageReference>` element in the project file.

Additionally, `Microsoft.AspNetCore.App` contained the following subcomponents:

- Json.NET (`Newtonsoft.Json`)
- Entity Framework Core (assemblies prefixed with `Microsoft.EntityFrameworkCore.`) 
- Roslyn (`Microsoft.CodeAnalysis`)

#### New behavior

References to `Microsoft.AspNetCore.App` will no longer be a `<PackageReference>` element in the project file. The .NET Core SDK will support a new element called
`<FrameworkReference>`, which will replace the use of `<PackageReference>`. Changes to support this new item type are already under way.

For more information, see [aspnet/AspNetCore#3612](https://github.com/aspnet/AspNetCore/issues/3612).

Entity Framework Core will ship as "pure" NuGet packages in 3.0. This change makes its shipping model the same as all other data access libraries on .NET. It provides Entity Framework Core the simplest path to continue innovating while providing support for all the various .NET platforms customers enjoy it on today. Note, Entity Framework Core moving out of the shared framework has no impact on its status as a Microsoft-developed, supported, and serviceable library. It will continue to be covered by the [.NET Core support policy](https://www.microsoft.com/net/platform/support-policy).

Json.NET and Entity Framework Core will continue to work with ASP.NET Core. They won't, however, be included in the shared framework.

See [The future of JSON in .NET Core 3.0](https://github.com/dotnet/announcements/issues/90) for details on our plans to remove the dependency from ASP.NET Core to Json.NET and replace it with high-performance JSON APIs.

We have separately posted [a complete list of exact binaries][items-removed-from-fx] that are being removed. This list may fluctuate as we continue to work on ASP.NET Core 3.0.

#### Reason for change

This change simplifies the consumption of `Microsoft.AspNetCore.App` and reduces the duplication between NuGet packages and shared frameworks.

For more information on the motivation for this change, see [this blog post][aspnet-blog].

#### Recommended action

As result these changes, it won't be necessary for projects to consume assemblies in `Microsoft.AspNetCore.App` as NuGet packages. To simplify the way in which consumers target and use the ASP.NET Core shared framework, we will stop producing many of the NuGet packages that we have been shipping since ASP.NET Core 1.0. The API those packages provide are still available to apps by using a `<FrameworkReference>` to `Microsoft.AspNetCore.App`. This includes commonly referenced APIs, such as Kestrel, MVC, Razor, and others.

This won't apply to all binaries that are pulled in via `Microsoft.AspNetCore.App` in 2.x. Notable exceptions include:

- `Microsoft.Extensions` libraries that continue to target .NET Standard will be available as NuGet packages (see https://github.com/aspnet/Extensions)
- APIs produced by the ASP.NET Core team that aren't part of `Microsoft.AspNetCore.App`. For example, the following components will ship as NuGet packages instead of being included in the shared framework:
    - Entity Framework Core
    - APIs that provide third-party integration
    - Experimental features
    - APIs with dependencies that couldn't [fulfill the requirements to be in the shared framework][shared-fx-guidance]
- Extensions to MVC that maintain support for Json.NET. We intend to provide an API as a NuGet package to support using Json.NET and MVC.
- The SignalR .NET client will continue to support .NET Standard and ship as a NuGet package. It's intended for use on many .NET runtimes, such as Xamarin and UWP.

For more information, see the [complete list of packages that will only be obsolete in favor of <FrameworkReference>][packages-removed-from-fx].

You can use [aspnet/AspNetCore#3757][discussion] for discussion.

[2.1-lts]: https://www.microsoft.com/net/download/dotnet-core/2.1
[aspnet-blog]: https://blogs.msdn.microsoft.com/webdev/2018/10/29/a-first-look-at-changes-coming-in-asp-net-core-3-0
[discussion]: https://github.com/aspnet/AspNetCore/issues/3757
[items-removed-from-fx]: https://github.com/aspnet/AspNetCore/issues/3755
[packages-removed-from-fx]: https://github.com/aspnet/AspNetCore/issues/3756
[shared-fx-guidance]: https://github.com/aspnet/AspNetCore/blob/4e44e5bcbedd961cc0d4f6b846699c7c494f5597/docs/SharedFramework.md

#### Category

ASP.NET Core

#### Affected APIs

- Json.NET (Newtonsoft.Json)
- Entity Framework Core (assemblies prefixed with `Microsoft.EntityFrameworkCore.`) 
- Roslyn (`Microsoft.CodeAnalysis`)

***

### Make "pubternal" types in MVC internal

In ASP.NET Core, "pubternal" types are declared as `public` but reside in a `.Internal`-suffixed namespace. While these types are `public`, they have no support policy and are subject to breaking changes. Unfortunately, accidental use of these types has been common, resulting in breaking changes to these projects and limiting our ability to maintain the framework.

In ASP.NET Core 3.0, we're updating all "pubternal" types in MVC to either be `public` in a supported namespace, or `internal` as appropriate.

#### Version introduced

3.0

#### Old behavior

Some types in MVC were `public` but in a `.Internal` namespace. These types had no support policy and were subject to breaking changes.

#### New behavior

All such types are updated either to be `public` in a supported namespace, or marked as `internal`.

#### Reason for change

Accidental use of the "pubternal" types has been common, resulting in breaking changes to these projects and limiting our ability to maintain the framework.

#### Recommended action

If you're using types that have become truly `public` and have been moved into a new, supported namespace, update your references to match the new namespaces.

If you're using types that have become marked as `internal`, you'll need to find an alternative. The previously "pubternal" types were never supported for public use. If there are specific types in these namespaces that are critical to your apps, file an issue at https://github.com/aspnet/AspNetCore. Considerations may be made for making the requested types `public`.

#### Category

ASP.NET Core

#### Affected APIs

This change includes types in the following namespaces:

- Microsoft.AspNetCore.Mvc.Formatters.Xml.Internal
- Microsoft.AspNetCore.Mvc.Cors.Internal
- Microsoft.AspNetCore.Mvc.ViewFeatures.Internal
- Microsoft.AspNetCore.Mvc.Formatters.Json.Internal
- Microsoft.AspNetCore.Mvc.RazorPages.Internal
- Microsoft.AspNetCore.Mvc.DataAnnotations.Internal
- Microsoft.AspNetCore.Mvc.TagHelpers.Internal
- Microsoft.AspNetCore.Mvc.Internal
- Microsoft.AspNetCore.Mvc.Razor.Internal
- Microsoft.AspNetCore.Mvc.Formatters.Internal
- Microsoft.AspNetCore.Mvc.Core.Internal
- Microsoft.AspNetCore.Mvc.ModelBinding.Internal

***

### Microsoft.AspNetCore.SpaServices and NodeServices no longer fallback to console logger by default

`Microsoft.AspNetCore.SpaServices` and `Microsoft.AspNetCore.NodeServices` won't display console logs unless logging is configured.

#### Version introduced

3.0

#### Old behavior

`Microsoft.AspNetCore.SpaServices` and `Microsoft.AspNetCore.NodeServices` used to automatically create a console logger when logging isn't configured. 

#### New behavior

`Microsoft.AspNetCore.SpaServices` and `Microsoft.AspNetCore.NodeServices` won't display console logs unless logging is configured.

#### Reason for change

To align them with how other AspNetCore packages implement logging, we are removing this automatic fallback.

#### Recommended action

If the old behavior is required, to configure console logging, add `services.AddLogging(builder => builder.AddConsole())` to your `Setup.ConfigureServices` method.

#### Category

ASP.NET Core

#### Affected APIs

Not detectable via API analysis

***

### Empty Microsoft.AspNetCore.Server.Kestrel.Https assembly being removed

The assembly `Microsoft.AspNetCore.Server.Kestrel.Https` has been removed.

#### Version introduced

3.0

#### Old behavior

The assembly `Microsoft.AspNetCore.Server.Kestrel.Https` was available.

#### New behavior

The assembly `Microsoft.AspNetCore.Server.Kestrel.Https` doesn't exist.

#### Reason for change

In ASP.NET Core 2.1, the contents of `Microsoft.AspNetCore.Server.Kestrel.Https` were moved to `Microsoft.AspNetCore.Server.Kestrel.Core`. This was done in a non-breaking way using `[TypeForwardedTo]` attributes.

#### Recommended action

- Libraries referencing `Microsoft.AspNetCore.Server.Kestrel.Https` 2.0 should update all AspNetCore dependencies to 2.1 or later. Otherwise, they may break when loaded into a 3.0 app.
- Apps and libraries targeting AspNetCore 2.1 and later should remove any direct references to the `Microsoft.AspNetCore.Server.Kestrel.Https` NuGet package.

#### Category

ASP.NET Core

#### Affected APIs

Not detectable via API analysis

***

### Session: obsolete APIs removed in 3.0 

This change removes APIs for configuring session cookies that were marked obsolete as part of https://github.com/aspnet/Announcements/issues/257.

#### Version introduced

3.0

#### Old behavior

Obsolete APIs were present in the runtime.

#### New behavior

Obsolete APIs were removed.

#### Reason for change

This change makes our APIs for configuring features that use cookies consistent across ASP.NET Core.

#### Recommended action

Migrate usage of the removed APIs to their newer replacements. For example:

```csharp
public void ConfigureServices(ServiceCollection services)
{
    services.AddSession(options =>
    {
        // Removed obsolete APIs
        options.CookieName = "SessionCookie";
        options.CookieDomain = "contoso.com";
        options.CookiePath = "/";
        options.CookieHttpOnly = true;
        options.CookieSecure = CookieSecurePolicy.Always;

        // new API
        options.Cookie.Name = "SessionCookie";
        options.Cookie.Domain = "contoso.com";
        options.Cookie.Path = "/";
        options.Cookie.HttpOnly = true;
        options.Cookie.SecurePolicy = CookieSecurePolicy.Always;
    });
}
```

#### Category

ASP.NET Core

#### Affected APIs

- [SessionOptions.CookieName](/dotnet/api/microsoft.aspnetcore.builder.sessionoptions.cookiedomain?view=aspnetcore-2.2#Microsoft_AspNetCore_Builder_SessionOptions_CookieName)
- [SessionOptions.CookieDomain](/dotnet/api/microsoft.aspnetcore.builder.sessionoptions.cookiedomain?view=aspnetcore-2.2#Microsoft_AspNetCore_Builder_SessionOptions_CookieDomain)
- [SessionOptions.CookiePath](/dotnet/api/microsoft.aspnetcore.builder.sessionoptions.cookiedomain?view=aspnetcore-2.2#Microsoft_AspNetCore_Builder_SessionOptions_CookiePath)
- [SessionOptions.CookieHttpOnly](/dotnet/api/microsoft.aspnetcore.builder.sessionoptions.cookiedomain?view=aspnetcore-2.2#Microsoft_AspNetCore_Builder_SessionOptions_CookieHttpOnly)
- [SessionOptions.CookieSecure](/dotnet/api/microsoft.aspnetcore.builder.sessionoptions.cookiedomain?view=aspnetcore-2.2#Microsoft_AspNetCore_Builder_SessionOptions_CookieSecure)

***

### Google+ based auth deprecation and replacement

Google is starting to [shut down](https://developers.google.com/+/api-shutdown) Google+ Signin for apps as early as January 28, 2019. ASP.NET 4.x and ASP.NET Core have been using the Google+ Signin APIs to authenticate Google account users in web apps. The affected NuGet packages are [Microsoft.AspNetCore.Authentication.Google](https://www.nuget.org/packages/Microsoft.AspNetCore.Authentication.Google/) for ASP.NET Core and [Microsoft.Owin.Security.Google](https://www.nuget.org/packages/Microsoft.Owin.Security.Google/) for `Microsoft.Owin` with ASP.NET Web Forms and MVC. Mitigations and solutions vary depending on the package and the version of the package that you use.

The replacement APIs Google has provided use a different data source and format. The mitigations and solutions provided below account for the structural changes. Apps will need to verify the data itself still satisfies their requirements. For example, names, email addresses, profile links, and profile photos may provide subtly different values than before.

#### Version introduced

All versions. This change is external to ASP.NET Core.

#### Old behavior

(see summary)

#### New behavior

(see summary)

#### Reason for change

This is a change to Google+ Signin APIs.

#### Recommended action

##### Microsoft.Owin with ASP.NET Web Forms and MVC

For `Microsoft.Owin` 3.1.0 and later, a temporary mitigation is outlined [here](https://github.com/aspnet/AspNetKatana/issues/251#issuecomment-449587635). Apps should complete testing with the mitigation to check for changes in the data format. We'll plan to release `Microsoft.Owin` 4.0.1 with a fix for this as soon as possible. Apps using any prior version will need to update to 4.0.1.

##### ASP.NET Core 1.x

The mitigation given above for [Microsoft.Owin](https://github.com/aspnet/AspNetKatana/issues/251#issuecomment-449587635) can also be adapted for ASP.NET Core 1.x. As 1.x is nearing [end of life](https://dotnet.microsoft.com/platform/support-policy) and has low usage, there are no plans to patch the NuGet packages for this issue.

##### ASP.NET Core 2.x

For `Microsoft.AspNetCore.Authentication.Google` version 2.x, replace your existing call to `AddGoogle` in `Startup.ConfigureServices` with the following code:

```csharp
.AddGoogle(o =>
{
    o.ClientId = Configuration["Authentication:Google:ClientId"];
    o.ClientSecret = Configuration["Authentication:Google:ClientSecret"];
    o.UserInformationEndpoint = "https://www.googleapis.com/oauth2/v2/userinfo";
    o.ClaimActions.Clear();
    o.ClaimActions.MapJsonKey(ClaimTypes.NameIdentifier, "id");
    o.ClaimActions.MapJsonKey(ClaimTypes.Name, "name");
    o.ClaimActions.MapJsonKey(ClaimTypes.GivenName, "given_name");
    o.ClaimActions.MapJsonKey(ClaimTypes.Surname, "family_name");
    o.ClaimActions.MapJsonKey("urn:google:profile", "link");
    o.ClaimActions.MapJsonKey(ClaimTypes.Email, "email");
});
```

Apps should do immediate testing with the new code to check for changes in the data format. Expect a fix for this to be included in the February 2.1 and 2.2 patches to incorporate the preceding reconfiguration as the new default. No patch is planned for 2.0 since it has reached [end of life](https://dotnet.microsoft.com/platform/support-policy).

##### ASP.NET Core 3.0 Preview

The mitigation given for 2.x can also be used for the current 3.0 preview. In future 3.0 previews, we're considering removing the `Microsoft.AspNetCore.Authentication.Google` package and directing users to `Microsoft.AspNetCore.Authentication.OpenIdConnect` instead. We'll follow up with the final plan. The following code shows how to replace `AddGoogle` with `AddOpenIdConnect` in `Startup.ConfigureServices`. This replacement can be used with ASP.NET Core 2.0 and later and can be adapted for 1.x as needed.

```csharp
.AddOpenIdConnect("Google", o =>
{
    o.ClientId = Configuration["Authentication:Google:ClientId"];
    o.ClientSecret = Configuration["Authentication:Google:ClientSecret"];
    o.Authority = "https://accounts.google.com";
    o.ResponseType = OpenIdConnectResponseType.Code;
    o.CallbackPath = "/signin-google"; // Or register the default "/sigin-oidc"
    o.Scope.Add("email");
});
JwtSecurityTokenHandler.DefaultInboundClaimTypeMap.Clear();
```

#### Category

ASP.NET Core

#### Affected APIs

[Microsoft.AspNetCore.Authentication.Google](https://www.nuget.org/packages/Microsoft.AspNetCore.Authentication.Google/)
[Microsoft.Owin.Security.Google](https://www.nuget.org/packages/Microsoft.Owin.Security.Google/) 

***

### ObjectPoolProvider removed from the default set of dependencies added in the WebHostBuilder

As part of making ASP.NET Core more pay for play, the `ObjectPoolProvider` was removed from the main set of dependencies. Specific components relying on `ObjectPoolProvider` now add it themselves.

If your component requires `ObjectPoolProvider`, it needs to be added to your dependencies via the `IServiceCollection`.

For discussion, see [aspnet/AspNetCore#5944](https://github.com/aspnet/AspNetCore/issues/5944).

#### Version introduced

3.0

#### Old behavior

`WebHostBuilder` provides `ObjectPoolProvider` by default in the DI container.

#### New behavior

`WebHostBuilder` no longer provides `ObjectPoolProvider` by default in the DI container.

#### Reason for change

This change was made to make ASP.NET Core more pay for play.

#### Recommended action

For anyone relying on `ObjectPoolProvider`, add them to your dependencies via the `IServiceCollection`.

#### Category

ASP.NET Core

#### Affected APIs

Not detectable via API analysis

### Deprecated Authentication property from HttpContext removed in ASP.NET Core

As part of [aspnet/AspNetCore#6504](https://github.com/aspnet/AspNetCore/pull/6504), the deprecated `Authentication` property on `HttpContext` has been removed. The `Authentication` property has been deprecated since 2.0. A [migration guide](/aspnet/core/migration/1x-to-2x/identity-2x?view=aspnetcore-2.2#use-httpcontext-authentication-extensions) was published to migrate code using this deprecated property to the new replacement APIs. In addition, the remaining unused classes / APIs related to the old 1.x authentication stack were removed in commit [aspnet/AspNetCore@d7a7c65](https://github.com/aspnet/AspNetCore/commit/d7a7c65).

To discuss this change, see https://github.com/aspnet/AspNetCore/issues/6533.

#### Version introduced

3.0

#### Old behavior

These APIs were available since 1.0 and were deprecated in 2.0.

#### New behavior

These APIs have been removed in 3.0.

#### Reason for change

The old 1.0 APIs have been replaced by extension methods in the `Microsoft.AspNetCore.Authentication` namespace. The new API is documented [here](/dotnet/api/microsoft.aspnetcore.authentication.authenticationhttpcontextextensions?view=aspnetcore-2.2).

#### Recommended action

The migration guide is available [here](/aspnet/core/migration/1x-to-2x/identity-2x?view=aspnetcore-2.2#use-httpcontext-authentication-extensions).

#### Category

ASP.NET Core

#### Affected APIs

[HttpContext.Authentication](/dotnet/api/microsoft.aspnetcore.http.httpcontext.authentication?view=aspnetcore-1.0)

**Classes**

- Microsoft.AspNetCore.Http.Authentication.AuthenticationManager
- Microsoft.AspNetCore.Http.Authentication.AuthenticateInfo
- Microsoft.AspNetCore.Http.Authentication.AuthenticationProperties
- Microsoft.AspNetCore.Http.Features.Authentication.AuthenticateContext
- Microsoft.AspNetCore.Http.Features.Authentication.ChallengeContext
- Microsoft.AspNetCore.Http.Features.Authentication.ChallengeBehavior
- Microsoft.AspNetCore.Http.Features.Authentication.DescribeSchemesContext
- Microsoft.AspNetCore.Http.Features.Authentication.IAuthenticationHandler
- Microsoft.AspNetCore.Http.Features.Authentication.SignInContext
- Microsoft.AspNetCore.Http.Features.Authentication.SignOutContext

**Properties**

Microsoft.AspNetCore.Http.Features.Authentication.IHttpAuthenticationFeature.Handler

***

### Removed extensibility for DefaultHttpContext

As part of performance improvements made to ASP.NET Core 3.0, we've removed the extensibility of `DefaultHttpContext`. The class is now `sealed`. For more information, see [aspnet/AspNetCore#6504](https://github.com/aspnet/AspNetCore/pull/6504). This extensibility was provided initially to allow pooling of the `HttpContext`, but it introduced more complexity than necessary and precluded other optimizations. As a result, we decided to remove this extensibility.

If your units tests use `Mock<DefaultHttpContext>`, use `Mock<HttpContext>` instead. 

For discussion, see https://github.com/aspnet/AspNetCore/issues/6534.

#### Version introduced

3.0

#### Old behavior

Classes could derive from `DefaultHttpContext`.

#### New behavior

`DefaultHttpContext` is `sealed`.

#### Reason for change

Extensibility introduced more complexity than necessary and precluded other optimizations. As a result, we decided to remove this extensibility.

#### Recommended action

If you're using `Mock<DefaultHttpContext>` in your unit tests, we recommend using `Mock<HttpContext>` instead. 

#### Category

ASP.NET Core

#### Affected APIs

[DefaultHttpContext](/dotnet/api/microsoft.aspnetcore.http.defaulthttpcontext)

***

### AspNetCoreModule V1 removed from Windows Hosting Bundle

Windows Hosting Bundle won't contain AspNetCoreModule V1 in the ASP.NET Core 3.0 release.

AspNetCoreModuleV2 is backwards compatible with AspNetCoreModule OutOfProcess and is recommended for use with ASP.NET Core 3.0 apps.

For discussion, see https://github.com/aspnet/AspNetCore/issues/7095.

#### Version introduced

3.0

#### Old behavior

AspNetCoreModule V1 was in Windows Hosting Bundle

#### New behavior

AspNetCoreModule V1 removed from Windows Hosting Bundle

#### Reason for change

AspNetCoreModuleV2 is backwards compatible with AspNetCoreModule OutOfProcess and is recommended for use with ASP.NET Core 3.0 apps.

#### Recommended action

Use AspNetCoreModuleV2 with ASP.NET Core 3.0 apps.

If AspNetCoreModule V1 is required, it can be installed using the 2.1/2.2 Windows Hosting Bundle.

This will break ASP.NET Core 3.0 apps that:

- Explicitly opted into using AspNetCoreModule V1 with `<AspNetCoreModuleName>AspNetCoreModule</AspNetCoreModuleName>`.
- Have a custom *web.config* file with `<add name="aspNetCore" path="*" verb="*" modules="AspNetCoreModule" resourceType="Unspecified" />`.

#### Category

ASP.NET Core

#### Affected APIs

Not detectable via API analysis

***

### MemoryCache: obsolete API removed in 3.0

This is a follow-up to https://github.com/aspnet/Caching/issues/221. The ASP.NET Core 3.0 release will remove the [obsolete `MemoryCacheOptions` APIs](https://github.com/aspnet/Extensions/blob/dc5c593da7b72c82e6fe85abb91d03818f9b700c/src/Caching/Memory/src/MemoryCacheOptions.cs#L17-L18). 

For discussion, see https://github.com/aspnet/Extensions/issues/1062.

#### Version introduced

3.0

#### Old behavior

`MemoryCacheOptions.CompactOnMemoryPressure` property was available.

#### New behavior

The `MemoryCacheOptions.CompactOnMemoryPressure` property has been removed.

#### Reason for change

Automatically compacting the cache caused problems. We recommend compacting the cache when needed to avoid unexpected behavior.

#### Recommended action

To compact the cache, downcast to `MemoryCache` and call `Compact` when needed.

#### Category

ASP.NET Core

#### Affected APIs

[MemoryCacheOptions.CompactOnMemoryPressure](/dotnet/api/microsoft.extensions.caching.memory.memorycacheoptions.compactonmemorypressure?view=aspnetcore-2.2)

***

### Newtonsoft.Json types replaced in Microsoft.AspNetCore.Authentication APIs

As part of the ongoing effort to [remove](https://github.com/aspnet/AspNetCore/issues/4260) `Newtonsoft.Json` from the shared framework, these types have now been replaced on the Authentication APIs.

**Basic usage of these Authentication packages should be unaffected.** Only users who have derived from the OAuth package or that had implemented advanced claim manipulation should be affected. A detailed list of affected APIs is given below.

 For more information, see https://github.com/aspnet/AspNetCore/pull/7105. For discussion, see https://github.com/aspnet/AspNetCore/issues/7289.

#### Version introduced

3.0

#### Old behavior

Types in `Newtonsoft.Json` were used.

#### New behavior

Types in `System.Text.Json` are used.

#### Reason for change

#### Recommended action

For derived OAuth implementations, the most common change is to replace `JObject.Parse` with `JsonDocument.Parse` in the `CreateTicketAsync` override as shown [here](https://github.com/aspnet/AspNetCore/pull/7105/files?utf8=%E2%9C%93&diff=unified&w=1#diff-e1c9f9740a6fe8021020a6f249c589b0L40). Note that `JsonDocument` implements `IDisposable`.

#### Category

ASP.NET Core

#### Affected APIs

Affected packages:

- Microsoft.AspNetCore.Authentication.OAuth
- Microsoft.AspNetCore.Authentication.OpenIdConnect
- Microsoft.AspNetCore.Authentication.Facebook
- Microsoft.AspNetCore.Authentication.Google
- Microsoft.AspNetCore.Authentication.Twitter
- Microsoft.AspNetCore.Authentication.MicrosoftAccount

Also, all derived implementations of OAuth such as those from [aspnet-contrib](https://github.com/aspnet-contrib/AspNet.Security.OAuth.Providers).

- [ClaimAction.Run(JObject userData, ClaimsIdentity identity, string issuer)](/dotnet/api/microsoft.aspnetcore.authentication.oauth.claims.claimaction.run?view=aspnetcore-2.2) becomes `ClaimAction.Run(JsonElement userData, ClaimsIdentity identity, string issuer)`. All derived implementations of `ClaimAction` are similarly affected.
- `MapCustomJson(this ClaimActionCollection collection, string claimType, Func<JObject, string> resolver)` becomes `MapCustomJson(this ClaimActionCollection collection, string claimType, Func<JsonElement, string> resolver)`
- `MapCustomJson(this ClaimActionCollection collection, string claimType, string valueType, Func<JObject, string> resolver)` becomes `MapCustomJson(this ClaimActionCollection collection, string claimType, string valueType, Func<JsonElement, string> resolver)`
- `OAuthCreatingTicketContext` has had one old constructor removed and the other replaced `JObject` with `JsonElement`. The `User` property and `RunClaimActions` method have been updated to match.
- `OAuthTokenResponse.Success` now accepts a parameter of type `JsonDocument` instead of `JObject`. The `Response` property has been updated to match. `OAuthTokenResponse` is now disposable and will be disposed by `OAuthHandler`. Derived OAuth implementations overriding `ExchangeCodeAsync` don't need to dispose the `JsonDocument` or `OAuthTokenResponse`.
- `UserInformationReceivedContext.User` changed from `JObject` to `JsonDocument`.
- `TwitterCreatingTicketContext.User` changed from `JObject` to `JsonElement`.
- `TwitterHandler.CreateTicketAsync` changed from accepting `JObject` to `JsonElement`.

***

### AllowSynchronousIO disabled in all servers

`AllowSynchronousIO` is an option in each server that enables or disables synchronous IO APIs like `HttpRequest.Body.Read`, `HttpResponse.Body.Write`, and `Stream.Flush`. These APIs have long been a source of thread starvation and app hangs. Starting in 3.0.0-preview3, these are disabled by default.

Affected servers:

- Kestrel
- HttpSys
- IIS in-process
- TestServer

Expect errors similar to:

- `Synchronous operations are disallowed. Call ReadAsync or set AllowSynchronousIO to true instead.`
- `Synchronous operations are disallowed. Call WriteAsync or set AllowSynchronousIO to true instead.`
- `Synchronous operations are disallowed. Call FlushAsync or set AllowSynchronousIO to true instead.`

Each server has an `AllowSynchronousIO` option that controls this behavior and the default for all of them is now `false`.

The behavior can also be overridden on a per-request basis as a temporary mitigation. For example:

```csharp
var syncIOFeature = HttpContext.Features.Get<IHttpBodyControlFeature>();
if (syncIOFeature != null)
{
    syncIOFeature.AllowSynchronousIO = true;
}
```

If you have trouble with TextWriters or other streams calling synchronous APIs in `Dispose`, call the new `DisposeAsync` API instead.

For discussion, see https://github.com/aspnet/AspNetCore/issues/7644.

#### Version introduced

3.0

#### Old behavior

`HttpRequest.Body.Read`, `HttpResponse.Body.Write`, and `Stream.Flush` were allowed by default.

#### New behavior

These synchronous APIs are disallowed by default: 

Expect errors similar to:

- `Synchronous operations are disallowed. Call ReadAsync or set AllowSynchronousIO to true instead.`
- `Synchronous operations are disallowed. Call WriteAsync or set AllowSynchronousIO to true instead.`
- `Synchronous operations are disallowed. Call FlushAsync or set AllowSynchronousIO to true instead.`

#### Reason for change

These APIs have long been a source of thread starvation and app hangs. Starting in 3.0.0-preview3 these are disabled by default.

#### Recommended action

Use the asynchronous versions of the methods. The behavior can also be overridden on a per-request basis as a temporary mitigation.

```csharp
var syncIOFeature = HttpContext.Features.Get<IHttpBodyControlFeature>();
if (syncIOFeature != null)
{
    syncIOFeature.AllowSynchronousIO = true;
}
```

#### Category

ASP.NET Core

#### Affected APIs

- [HttpRequest.Body.Read](/dotnet/api/system.io.stream.read?view=netframework-4.8)
- [HttpResponse.Body.Flush](/dotnet/api/system.io.stream.flush?view=netframework-4.8)
- [HttpResponse.Body.Write](/dotnet/api/system.io.stream.write?view=netframework-4.8)

***

### Breaking changes to runtime compilation for Razor views and Razor Pages

Support for runtime compilation of Razor views and Razor Pages is being moved to a separate package.

#### Version introduced

3.0

#### Old behavior

Runtime compilation was available without needing any additional packages.

#### New behavior

The functionality has been moved to the `Microsoft.AspNetCore.Mvc.Razor.RuntimeCompilation` package.

The following APIs previously available on `Microsoft.AspNetCore.Mvc.Razor.RazorViewEngineOptions` to support runtime compilation would now be available via
`Microsoft.AspNetCore.Mvc.Razor.RuntimeCompilation.MvcRazorRuntimeCompilationOptions`:

- `RazorViewEngineOptions.FileProviders` -> `MvcRazorRuntimeCompilationOptions.FileProviders`
- `RazorViewEngineOptions.AdditionalCompilationReferences` -> `MvcRazorRuntimeCompilationOptions.AdditionalReferencePaths`

In addition, `Microsoft.AspNetCore.Mvc.Razor.RazorViewEngineOptions.AllowRecompilingViewsOnFileChange` has been removed. Recompilation on file changes is enabled by default by referencing the `Microsoft.AspNetCore.Mvc.Razor.RuntimeCompilation` package.

#### Reason for change

To clean up the ASP.NET Core shared framework to not depend on Roslyn.

#### Recommended action

Apps that require runtime compilation or recompilation of Razor files should take the following steps:

1. Add a reference to the `Microsoft.AspNetCore.Mvc.Razor.RuntimeCompilation` package.
1. Update the project's `Startup.ConfigureServices` method to include a call to `AddMvcRazorRuntimeCompilation`. For example:

    ```csharp
    services.AddMvc()
        .AddMvcRazorRuntimeCompilation();
    ```

#### Category

ASP.NET Core

#### Affected APIs

[Microsoft.AspNetCore.Mvc.Razor.RazorViewEngineOptions](/dotnet/api/microsoft.aspnetcore.mvc.razor.razorviewengineoptions?view=aspnetcore-2.2)

***

### IHostingEnvironment's and IApplicationLifetime's marked obsolete and replaced

New types have been introduced to replace existing `IHostingEnvironment` and `IApplicationLifetime` types.

#### Version introduced

3.0

#### Old behavior

There were two different `IHostingEnvironment` and `IApplicationLifetime` types from `Microsoft.Extensions.Hosting` and `Microsoft.AspNetCore.Hosting`.

#### New behavior

The old types have been obsoleted and replaced by new types.

#### Reason for change

When `Microsoft.Extensions.Hosting` was introduced in ASP.NET Core 2.1, some types like `IHostingEnvironment` and `IApplicationLifetime` were copied from `Microsoft.AspNetCore.Hosting`. Some ASP.NET Core 3.0 changes cause apps to include both the `Microsoft.Extensions.Hosting` and `Microsoft.AspNetCore.Hosting` namespaces. Any use of those duplicate types causes an "ambiguous reference" compiler error when both namespaces are referenced.

#### Recommended action

Replaced any usages of the old types with the newly introduced types as below:

**Obsolete types (warning):**

- `Microsoft.Extensions.Hosting.IHostingEnvironment`
- `Microsoft.AspNetCore.Hosting.IHostingEnvironment`
- `Microsoft.Extensions.Hosting.IApplicationLifetime`
- `Microsoft.AspNetCore.Hosting.IApplicationLifetime`
- `Microsoft.Extensions.Hosting.EnvironmentName`
- `Microsoft.AspNetCore.Hosting.EnvironmentName`

**New types:**

- `Microsoft.Extensions.Hosting.IHostEnvironment`
- `Microsoft.AspNetCore.Hosting.IWebHostEnvironment : IHostEnvironment`
- `Microsoft.Extensions.Hosting.IHostApplicationLifetime`
- `Microsoft.Extensions.Hosting.Environments`

Note the new `IHostEnvironment` `IsDevelopment`, `IsProduction`, etc. extension methods are in the `Microsoft.Extensions.Hosting` namespace. That namespace may need to be added to your project.

#### Category

ASP.NET Core

#### Affected APIs

- [Microsoft.Extensions.Hosting.IHostingEnvironment](/dotnet/api/microsoft.extensions.hosting.ihostingenvironment?view=aspnetcore-2.2)
- [Microsoft.AspNetCore.Hosting.IHostingEnvironment](/dotnet/api/microsoft.aspnetcore.hosting.ihostingenvironment?view=aspnetcore-2.2)
- [Microsoft.Extensions.Hosting.IApplicationLifetime](/dotnet/api/microsoft.extensions.hosting.iapplicationlifetime?view=aspnetcore-2.2)
- [Microsoft.AspNetCore.Hosting.IApplicationLifetime](/dotnet/api/microsoft.aspnetcore.hosting.iapplicationlifetime?view=aspnetcore-2.2)
- [Microsoft.Extensions.Hosting.EnvironmentName](/dotnet/api/microsoft.extensions.hosting.environmentname?view=aspnetcore-2.2)
- [Microsoft.AspNetCore.Hosting.EnvironmentName](/dotnet/api/microsoft.aspnetcore.hosting.environmentname?view=aspnetcore-2.2)

***

### ResourceManagerWithCultureStringLocalizer class and WithCulture interface member marked Obsolete and will be removed

The [ResourceManagerWithCultureStringLocalizer](https://github.com/aspnet/Localization/blob/43b974482c7b703c92085c6f68b3b23d8fe32720/src/Microsoft.Extensions.Localization/ResourceManagerWithCultureStringLocalizer.cs#L18) class and [WithCulture](https://github.com/aspnet/Localization/blob/master/src/Microsoft.Extensions.Localization/ResourceManagerStringLocalizer.cs#L154-L170) interface member are often sources of confusion for users of Localization, especially if they want to create their own `IStringLocalizer` implementation. These items give the user the impression that we expect an `IStringLocalizer` instance to be "per-language, per-resource", when actually they should only be "per-resource", with the language searched for determined by the `CultureInfo.CurrentUICulture` at execution time. To remove this source of confusion and to avoid APIs that we don't want users to use, we'll be obsoleting these in 3.0.0-preview3, and they'll be removed in a future release (4.0 or above). 

For context, see [here](https://github.com/aspnet/AspNetCore/issues/3324). For discussion, see [aspnet/AspNetCore#7756](https://github.com/aspnet/AspNetCore/issues/7756).

#### Version introduced

3.0

#### Old behavior

Methods weren't marked as `Obsolete`.

#### New behavior

Methods are marked `Obsolete`.

#### Reason for change

API represented a use case that isn't recommended, and leads to confusion about the design of Localization.

#### Recommended action

The recommendation is to use `ResourceManagerStringLocalizer` instead. Let the culture be set by the `CurrentCulture`. If that isn't an option, you may create and use a copy of [ResourceManagerWithCultureStringLocalizer](https://github.com/aspnet/Localization/blob/43b974482c7b703c92085c6f68b3b23d8fe32720/src/Microsoft.Extensions.Localization/ResourceManagerWithCultureStringLocalizer.cs#L18).

#### Category

ASP.NET Core

#### Affected APIs

- [ResourceManagerWithCultureStringLocalizer](/dotnet/api/microsoft.extensions.localization.resourcemanagerwithculturestringlocalizer?view=aspnetcore-3.0)
- [ResourceManagerStringLocalizer.WithCulture](/dotnet/api/microsoft.extensions.localization.resourcemanagerstringlocalizer.withculture?view=aspnetcore-3.0#Microsoft_Extensions_Localization_ResourceManagerStringLocalizer_WithCulture_System_Globalization_CultureInfo_)

***

### ResetSendPing and ResetTimeout APIs Removed from SignalR HubConnection class

The `ResetSendPing` and `ResetTimeout` APIs were removed from the SignalR's `HubConnection` API. These methods were originally intended only for internal use but were made public in 2.2. These APIs will no longer be available starting in the 3.0 Preview 4 release. For discussion, see https://github.com/aspnet/AspNetCore/issues/8543.

#### Version introduced

3.0

#### Old behavior

APIs were available.

#### New behavior

APIs are removed.

#### Reason for change

These methods were originally intended only for internal use but were made public in 2.2.

#### Recommended action

Discontinue use of these methods.

#### Category

ASP.NET Core

#### Affected APIs

- [HubConnection.ResetSendPing](/dotnet/api/microsoft.aspnetcore.signalr.client.hubconnection.resetsendping?view=aspnetcore-3.0#Microsoft_AspNetCore_SignalR_Client_HubConnection_ResetSendPing)
- [HubConnection.ResetTimeout](/dotnet/api/microsoft.aspnetcore.signalr.client.hubconnection.resettimeout?view=aspnetcore-3.0#Microsoft_AspNetCore_SignalR_Client_HubConnection_ResetTimeout)

***

### Async suffix for controller action names will be trimmed by default

As part of addressing https://github.com/aspnet/AspNetCore/issues/4849, ASP.NET Core MVC will trim the suffix `Async` from action names by default. This affects routing and link generation.

#### Version introduced

3.0

#### Old behavior

Consider the following ASP.NET Core MVC controller:

```csharp
public class ProductController : Controller
{
    public async IActionResult ListAsync()
    {
        var model = await DbContext.Products.ToListAsync();
        return View(model);
    }
}
```

Prior to 3.0, the action will be routable via `Product/ListAsync`. Link generation would require specifying the `Async` suffix. For example:

```cshtml
<a asp-controller="Product" asp-action="ListAsync">List</a>
```

#### New behavior

In ASP.NET Core 3.0, the action will be routable via `Product/List`. Link generation will require not specifying the `Async` suffix. For example:

```cshtml
<a asp-controller="Product" asp-action="List">List</a>
```

This change doesn't affect names specified using the `[ActionName]` attribute.

This behavior can be disabled by setting `MvcOptions.SuppressAsyncSuffixInActionNames` to `false` in `Startup.ConfigureServices`:

```csharp
services.AddMvc(options =>
{
   options.SuppressAsyncSuffixInActionNames = false; 
});
```

#### Reason for change

Asynchronous .NET methods, by convention, end with the `Async` suffix. However, when a method defines an MVC action, it's undesirable to use the `Async` suffix.

#### Recommended action

If your app depends on MVC actions retaining the `Async` suffix in the name, you can:

- Use `[ActionName]` attribute to preserve the original name.
- Disable the renaming entirely by setting `MvcOptions.SuppressAsyncSuffixInActionNames` to `false` in `Startup.ConfigureServices`:

```csharp
services.AddMvc(options =>
{
   options.SuppressAsyncSuffixInActionNames = false; 
});
```

#### Category

ASP.NET Core

#### Affected APIs

Not detectable via API analysis

***

### Generic Host restricts Startup constructor injection

The only types the generic Host supports for `Startup` class constructor injection are `IHostEnvironment`, `IWebHostEnvironment`, and `IConfiguration`. Apps using `WebHost` are unaffected.

In ASP.NET Core 3.0, the web stack was replatformed onto the generic host library. You can see the change in *Program.cs* in the templates:

**2.x:**

https://github.com/aspnet/AspNetCore/blob/5cb615fcbe8559e49042e93394008077e30454c0/src/Templating/src/Microsoft.DotNet.Web.ProjectTemplates/content/EmptyWeb-CSharp/Program.cs#L20-L22

**3.0:**

https://github.com/aspnet/AspNetCore/blob/b1ca2c1155da3920f0df5108b9fedbe82efaa11c/src/ProjectTemplates/Web.ProjectTemplates/content/EmptyWeb-CSharp/Program.cs#L19-L24

One key behavior change is that `Host` only uses one dependency injection (DI) container to build the app, as opposed to `WebHost` that used one for the host and one for the app. As a result, the `Startup` constructor no longer supports custom service injection. Only `IHostEnvironment`, `IWebHostEnvironment`, and `IConfiguration` can be injected. This change was made to avoid DI issues such as the duplicate creation of singleton services.

#### Version introduced

3.0

#### Old behavior

Constructor injection could be used for arbitrary types in the `Startup` class's constructor.

#### New behavior

The following types can be injected:

- `IHostEnvironment`
- `IWebHostEnvironment`
- `IConfiguration`

#### Reason for change

This is a consequence of replatforming the web stack onto the generic host library.

#### Recommended action

You may mitigate this by injecting services into the `Startup.Configure` method signature. For example:

```csharp
public void Configure(IApplicationBuilder app, IOptions<MyOptions> options)
```

#### Category

ASP.NET Core

#### Affected APIs

App's Startup.

***

### Make "pubternal" types in ResponseCaching internal

In ASP.NET Core, "pubternal" types are declared as `public` but reside in a namespace suffixed with `.Internal`. While these types are public, they have no support policy and are subject to breaking changes. Unfortunately, accidental use of these types has been common, resulting in breaking changes to these projects and limiting our ability to maintain the framework.

In ASP.NET Core 3.0, "pubternal" types in ResponseCaching have been changed to `internal`.

In addition, a default implementation for `IResponseCachingPolicyProvider` and `IResponseCachingKeyProvider` will no longer be added to services as part of the `AddResponseCaching` method.

#### Version introduced

3.0

#### Old behavior

These types were publicly visible, but unsupported.

#### New behavior

These types are now `internal`.

#### Reason for change

They better reflect the unsupported policy.

#### Recommended action

We recommend copying types that are used by your app or library.

#### Category

ASP.NET Core

#### Affected APIs

- `Microsoft.AspNetCore.ResponseCaching.Internal.CachedResponse`
- `Microsoft.AspNetCore.ResponseCaching.Internal.CachedVaryByRules`
- `Microsoft.AspNetCore.ResponseCaching.Internal.IResponseCache`
- `Microsoft.AspNetCore.ResponseCaching.Internal.IResponseCacheEntry`
- `Microsoft.AspNetCore.ResponseCaching.Internal.IResponseCachingKeyProvider`
- `Microsoft.AspNetCore.ResponseCaching.Internal.IResponseCachingPolicyProvider`
- `Microsoft.AspNetCore.ResponseCaching.Internal.MemoryResponseCache`
- `Microsoft.AspNetCore.ResponseCaching.Internal.ResponseCachingContext`
- `Microsoft.AspNetCore.ResponseCaching.Internal.ResponseCachingKeyProvider`
- `Microsoft.AspNetCore.ResponseCaching.Internal.ResponseCachingPolicyProvider`
- /dotnet/api/microsoft.aspnetcore.responsecaching.responsecachingmiddleware.-ctor?view=aspnetcore-2.2

***

### DataProtection.AzureStorage 3.0 will be updated to use new Microsoft.Azure.Storage APIs

`Microsoft.AspNetCore.DataProtection.AzureStorage` depends on the [Azure Storage libraries](https://github.com/Azure/azure-storage-net). Recently, these libraries have renamed their assemblies, packages, and namespaces. Starting in ASP.NET Core 3.0, we have moved our dependency to use the new `Microsoft.Azure.Storage.`-prefixed APIs and packages. 

If you still need to use the older Azure Storage APIs with ASP.NET Core 3.0, add a direct dependency to the [WindowsAzure.Storage](https://www.nuget.org/packages/WindowsAzure.Storage/) package. This package can be installed alongside the new `Microsoft.Azure.Storage` APIs.

For questions about the Azure Storage APIs, use https://github.com/Azure/azure-storage-net. For discussion on this issue, use https://github.com/aspnet/AspNetCore/issues/8472.

#### Version introduced

3.0

#### Old behavior

The package referenced the `WindowsAzure.Storage` NuGet package.

#### New behavior

The package references the `Microsoft.Azure.Storage.Blob` NuGet package.

#### Reason for change

This allows `Microsoft.AspNetCore.DataProtection.AzureStorage` to migrate to the recommended Azure Storage packages.

#### Recommended action

Changes to your code may be necessary to use the new API. In many cases, the upgrade is as simple as changing the `using` statements to use the new namespaces:

```diff
- using Microsoft.WindowsAzure.Storage;
- using Microsoft.WindowsAzure.Storage.Blob;
+ using Microsoft.Azure.Storage;
+ using Microsoft.Azure.Storage.Blob;
```

#### Category

ASP.NET Core

#### Affected APIs

Not detectable via API analysis

***

### HeaderNames now contains static readonly fields instead of const fields 

The static [Microsoft.Net.Http.Headers.HeaderNames](/dotnet/api/microsoft.net.http.headers.headernames?view=aspnetcore-2.2) class contains string fields representing various common header names. For example, [HeaderNames.Origin](/dotnet/api/microsoft.net.http.headers.headernames.origin?view=aspnetcore-2.2). Starting in ASP.NET Core 3.0 Preview 5, these will change from `const` fields to `static readonly` fields.

For discussion, see [aspnet/AspNetCore#9514](https://github.com/aspnet/AspNetCore/issues/9514).

#### Version introduced

3.0

#### Old behavior

These fields used to be `const`

#### New behavior

These fields are now `static readonly`.

#### Reason for change

The change prevents the values from being embedded across assembly boundaries, allowing for value corrections as needed. It also enables faster reference equality checks.

#### Recommended action

Recompile against 3.0. Source code that used these fields as an attribute argument, a `case` in a `switch` statement, or when defining another constant can no longer do so. To work around this break, developers can switch to using self-defined header name constants or string literals.

#### Category

ASP.NET Core

#### Affected APIs

All fields on [Microsoft.Net.Http.Headers.HeaderNames](/dotnet/api/microsoft.net.http.headers.headernames)

***

### Default Bootstrap version of IdentityUI changed to 4

Currently, the default version of Bootstrap for IdentityUI is `UIFramework.Bootstrap3`. Starting in ASP.NET Core 3.0, the default version will be `UIFramework.Bootstrap4`.

#### Version introduced

3.0

#### Old behavior

The `services.AddDefaultIdentity<IdentityUser>().AddDefaultUI();` method call was the same as `services.AddDefaultIdentity<IdentityUser>().AddDefaultUI(UIFramework.Bootstrap3);`

#### New behavior

The `services.AddDefaultIdentity<IdentityUser>().AddDefaultUI();` method call is the same as `services.AddDefaultIdentity<IdentityUser>().AddDefaultUI(UIFramework.Bootstrap4);`

#### Reason for change

Bootstrap 4 was released during ASP.NET Core 3.0 timeframe.

#### Recommended action

If you happen to use the default Identity UI and have wired it up in `Startup.ConfigureServices` as shown below, you're impacted by this change:

```csharp
services.AddDefaultIdentity<IdentityUser>().AddDefaultUI();
```

Take one of the following actions:

- Migrate your app to use Bootstrap 4 using their [migration guide](https://getbootstrap.com/docs/4.0/migration).
- Update your `Startup.ConfigureServices` code to enforce usage of Bootstrap 3. For example:

    ```csharp
    services.AddDefaultIdentity<IdentityUser>().AddDefaultUI(UIFramework.Bootstrap3);
    ```

#### Category

ASP.NET Core

#### Affected APIs

Not detectable via API analysis

***

### ASP.NET Core Kestrel Request trailer headers moved to new collection

In prior versions, Kestrel would add HTTP/1.1 chunked trailer headers into the request headers collection when the request body was read to the end. This behavior caused some concerns about ambiguity between headers and trailers. The decision was made to move the trailers to a new collection.

HTTP/2 request trailers were unavailable in 2.2, but are now also available in this new collection in ASP.NET Core 3.0.

New request extension methods have been added to access these trailers.

HTTP/1.1 trailers are available once the entire request body has been read.

HTTP/2 trailers are available as soon as they're received from the client, but the client won't send them until the entire request body has been at least buffered by the server. You may need to read the request body to free up buffer space. Trailers will always be available if you read the request body to the end, as the trailers mark the end of the body.

#### Version introduced

3.0

#### Old behavior

Request trailer headers would be added to the `HttpRequest.Headers` collection.

#### New behavior

Request trailer headers **aren't present** in the `HttpRequest.Headers` collection. Use the following extension methods on `HttpRequest` to access them:

- `GetDeclaredTrailers()` - Gets the request "Trailer" header that lists which trailers to expect after the body.
- `SupportsTrailers()` - Indicates if the request supports receiving trailer headers.
- `CheckTrailersAvailable()` - Checks if the request supports trailers and if they're available for reading.
- `GetTrailer(string trailerName)` - Gets the requested trailing header from the response.

#### Reason for change

Trailers are a key feature in scenarios like gRPC. Merging the trailers in to request headers was confusing to users.

#### Recommended action

Use the trailer-related extension methods on `HttpRequest` to access trailers.

#### Category

ASP.NET Core

#### Affected APIs

[HttpRequest.Headers](/dotnet/api/microsoft.aspnetcore.http.httprequest.headers?view=aspnetcore-2.2#Microsoft_AspNetCore_Http_HttpRequest_Headers)

***

### SignInAsync will throw by default when given an unauthenticated identity

`SignInAsync` will now throw by default for principals / identities where `IsAuthenticated` is `false`.

#### Version introduced

3.0

#### Old behavior

`SignInAsync` would accept any principals / identities, this included identities where `IsAuthenticated` is `false`.

#### New behavior

`SignInAsync` will now throw by default for principals / identities where `IsAuthenticated` is `false`. There's a new flag to toggle this behavior, but the default behavior has changed.

#### Reason for change

The old behavior was problematic because, by default, these principals would get rejected by `[Authorize]` / `RequireAuthenticatedUser()`.

#### Recommended action

There's a new `RequireAuthenticatedSignIn` flag on `AuthenticationOptions` that is `true` by default as of ASP.NET Core 3.0 Preview 6. Setting this flag to `false` reverts to the old behavior.

#### Category

ASP.NET Core

#### Affected APIs

Not detectable via API analysis

***

### UseSignalR and UseConnections are marked obsolete

The methods `UseConnections` and `UseSignalR`, and the classes `ConnectionsRouteBuilder` and `HubRouteBuilder` are being marked obsolete in 3.0.

#### Version introduced

3.0

#### Old behavior

SignalR hub routing was configured using `UseSignalR`, `UseConnections`.

#### New behavior

The old way of configuring routing has been obsoleted and replaced with endpoint routing.

#### Reason for change

We're moving middleware to the new endpoint routing system so we're obsoleting the old way of adding middleware.

#### Recommended action

Replace `UseSignalR` with `UseEndpoints`:

**Old code:**

```csharp
app.UseSignalR(routes =>
{
    routes.MapHub<SomeHub>("/path");
});
```

**New code:**

```csharp
app.UseEndpoints(endpoints =>
{
    endpoints.MapHub<SomeHub>("/path");
});
```

#### Category

ASP.NET Core

#### Affected APIs

- [Microsoft.AspNetCore.Builder.IApplicationBuilder.UseSignalR](/dotnet/api/microsoft.aspnetcore.builder.signalrappbuilderextensions.usesignalr?view=aspnetcore-2.2#Microsoft_AspNetCore_Builder_SignalRAppBuilderExtensions_UseSignalR_Microsoft_AspNetCore_Builder_IApplicationBuilder_System_Action_Microsoft_AspNetCore_SignalR_HubRouteBuilder__)
- [Microsoft.AspNetCore.Builder.IApplicationBuilder.UseConnections](/dotnet/api/microsoft.aspnetcore.builder.connectionsappbuilderextensions.useconnections?view=aspnetcore-2.2#Microsoft_AspNetCore_Builder_ConnectionsAppBuilderExtensions_UseConnections_Microsoft_AspNetCore_Builder_IApplicationBuilder_System_Action_Microsoft_AspNetCore_Http_Connections_ConnectionsRouteBuilder__)
- [Microsoft.AspNetCore.Http.Connections.ConnectionsRouteBuilder](/dotnet/api/microsoft.aspnetcore.http.connections.connectionsroutebuilder?view=aspnetcore-2.2)
- [Microsoft.AspNetCore.SignalR.HubRouteBuilder](/dotnet/api/microsoft.aspnetcore.signalr.hubroutebuilder?view=aspnetcore-2.2)

***

### Kestrel's transport abstractions have been removed and made public 

As part of moving away from "pubternal" APIs, the Kestrel transport layer APIs are now exposed as a public interface(s) in the `Microsoft.AspNetCore.Connections.Abstractions` library

#### Version introduced

3.0

#### Old behavior

- Transport-related abstractions were available in the `Microsoft.AspNetCore.Server.Kestrel.Transport.Abstractions` library.
- The `ListenOptions.NoDelay` property was available.

#### New behavior

- The `IConnectionListener` interface was introduced in the `Microsoft.AspNetCore.Connections.Abstractions` library to expose the most used functionality from the `...Transport.Abstractions` library.
- The `NoDelay` is now available in transport options (`LibuvTransportOptions` and `SocketTransportOptions`).
- `SchedulingMode` is no longer available.

#### Reason for change

ASP.NET Core 3.0 has moved away from "pubternal" APIs.

#### Recommended action

#### Category

ASP.NET Core

#### Affected APIs

Not detectable via API analysis

***

### OAuthHandler ExchangeCodeAsync signature change

The signature of `OAuthHandler.ExchangeCodeAsync` was changed from:

```csharp
protected virtual System.Threading.Tasks.Task<Microsoft.AspNetCore.Authentication.OAuth.OAuthTokenResponse> ExchangeCodeAsync(string code, string redirectUri) { throw null; }
```

To:

```csharp
protected virtual System.Threading.Tasks.Task<Microsoft.AspNetCore.Authentication.OAuth.OAuthTokenResponse> ExchangeCodeAsync(Microsoft.AspNetCore.Authentication.OAuth.OAuthCodeExchangeContext context) { throw null; }
```

#### Version introduced

3.0

#### Old behavior

The `code` and `redirectUri` strings were passed as separate arguments.

#### New behavior

`Code` and `RedirectUri` are now properties on `OAuthCodeExchangeContext` that can be set via the `OAuthCodeExchangeContext` constructor. This new `OAuthCodeExchangeContext` type is the only argument passed to `OAuthHandler.ExchangeCodeAsync`.

#### Reason for change

To flow additional parameters in a way that allows for similar non-breaking changes to be made in the future without adding new `ExchangeCodeAsync` overloads.

#### Recommended action

Construct an `OAuthCodeExchangeContext` with the appropriate `code` and `redirectUri` values. An [AuthenticationProperties](/dotnet/api/microsoft.aspnetcore.authentication.authenticationproperties?view=aspnetcore-2.2) will also need to be passed in. This single `OAuthCodeExchangeContext` can then be passed to `OAuthHandler.ExchangeCodeAsync` instead of multiple arguments.

#### Category

ASP.NET Core

#### Affected APIs

[OAuthHandler<TOptions>.ExchangeCodeAsync(string code, string redirectUri)](/dotnet/api/microsoft.aspnetcore.authentication.oauth.oauthhandler-1.exchangecodeasync?view=aspnetcore-2.2#Microsoft_AspNetCore_Authentication_OAuth_OAuthHandler_1_ExchangeCodeAsync_System_String_System_String_)

***

### DebugLogger class made internal in ASP.NET Core 3.0

`DebugLogger` has effectively been removed. It was previously `public`. Now it's `internal` to match other logger implementations such as `ConsoleLogger`.

#### Version introduced

3.0

#### Old behavior

`DebugLogger` was `public`.

#### New behavior

`DebugLogger` is `internal`.

#### Reason for change

Consistency and reduction of API surface.

#### Recommended action

Use the [AddDebug](/dotnet/api/microsoft.extensions.logging.debugloggerfactoryextensions.adddebug?view=aspnetcore-3.0) `ILoggingBuilder` extension method to enable debug logging. [DebugLoggerProvider](/dotnet/api/microsoft.extensions.logging.debug.debugloggerprovider?view=aspnetcore-3.0) is also still `public` in the event the service needs to be registered manually.

#### Category

ASP.NET Core

#### Affected APIs

[DebugLogger](/dotnet/api/microsoft.extensions.logging.debug.debuglogger?view=aspnetcore-2.2)

***

### SignalR HandshakeProtocol.SuccessHandshakeData removed and replaced with helper method

The [HandshakeProtocol.SuccessHandshakeData](https://github.com/aspnet/AspNetCore/blob/c5b2bc0df2a0027832bf7d01dfb19ca39cd08ae6/src/SignalR/common/SignalR.Common/src/Protocol/HandshakeProtocol.cs#L27) field was removed and replaced with a helper method that generates a successful handshake response given a specific `IHubProtocol`. 

#### Version introduced

3.0

#### Old behavior

`HandshakeProtocol.SuccessHandshakeData` was a `public static ReadOnlyMemory<byte>` field.

#### New behavior

`HandshakeProtocol.SuccessHandshakeData` has been replaced by a `static` `GetSuccessfulHandshake(IHubProtocol protocol)` method that returns a `ReadOnlyMemory<byte>` based on the specified protocol. 

#### Reason for change

This change was made because additional fields were added to the handshake _response_ that are non-constant and change depending on the selected protocol.

#### Recommended action

None. This type isn't designed for use from user code. It's `public`, so it can be shared between the SignalR server and client. It may also be used by customer SignalR clients written in .NET. **Users** of SignalR shouldn't be affected by this change.

#### Category

ASP.NET Core

#### Affected APIs

[HandshakeProtocol.SuccessHandshakeData Field](/dotnet/api/microsoft.aspnetcore.signalr.protocol.handshakeprotocol.successhandshakedata?view=aspnetcore-2.2)

***

### SignalR HubConnectionContext constructors changing

We are changing SignalR's `HubConnectionContext` constructors to take in an options type rather than multiple parameters to future-proof adding options. This removes two constructors in favor of a single constructor that accepts an option type.

#### Version introduced

3.0

#### Old behavior

`HubConnectionContext` had two constructors:

```csharp
public HubConnectionContext(ConnectionContext connectionContext, TimeSpan keepAliveInterval, ILoggerFactory loggerFactory);
public HubConnectionContext(ConnectionContext connectionContext, TimeSpan keepAliveInterval, ILoggerFactory loggerFactory, TimeSpan clientTimeoutInterval);
```

#### New behavior

The two constructors have been removed and replaced them with one constructor:

```csharp
public HubConnectionContext(ConnectionContext connectionContext, HubConnectionContextOptions contextOptions, ILoggerFactory loggerFactory)
```

#### Reason for change

The new constructor makes use of a new options object, so we can expand the features of `HubConnectionContext` in the future without making more constructors and breaking changes.

#### Recommended action

Instead of calling:

```csharp
HubConnectionContext connectionContext = new HubConnectionContext(
    connectionContext, 
    keepAliveInterval: TimeSpan.FromSeconds(15), 
    loggerFactory, 
    clientTimeoutInterval: TimeSpan.FromSeconds(15));
```

They would now call:

```csharp
HubConnectionContextOptions contextOptions = new HubConnectionContextOptions()
{
    KeepAliveInterval = TimeSpan.FromSeconds(15),
    ClientTimeoutInterval = TimeSpan.FromSeconds(15)
};
HubConnectionContext connectionContext = new HubConnectionContext(connectionContext, contextOptions, loggerFactory);
```

#### Category

ASP.NET Core

#### Affected APIs

- [HubConnectionContext.ctor(ConnectionContext, TimeSpan , ILoggerFactory)](/dotnet/api/microsoft.aspnetcore.signalr.hubconnectioncontext.-ctor?view=aspnetcore-2.2#Microsoft_AspNetCore_SignalR_HubConnectionContext__ctor_Microsoft_AspNetCore_Connections_ConnectionContext_System_TimeSpan_Microsoft_Extensions_Logging_ILoggerFactory_)
- [HubConnectionContext.ctor(ConnectionContext, TimeSpan , ILoggerFactory, TimeSpan)](/dotnet/api/microsoft.aspnetcore.signalr.hubconnectioncontext.-ctor?view=aspnetcore-2.2#Microsoft_AspNetCore_SignalR_HubConnectionContext__ctor_Microsoft_AspNetCore_Connections_ConnectionContext_System_TimeSpan_Microsoft_Extensions_Logging_ILoggerFactory_)

***

### Microsoft.Extensions.Caching.SqlServer is now using the new Microsoft.Data.SqlClient package

The `Microsoft.Extensions.Caching.SqlServer` package will use the new `Microsoft.Data.SqlClient` package instead of `System.Data.SqlClient` package. This change could cause slight behavioral breaking changes. For more information, see https://devblogs.microsoft.com/dotnet/introducing-the-new-microsoftdatasqlclient/.

#### Version introduced

3.0

#### Old behavior

The `Microsoft.Extensions.Caching.SqlServer` package used the `System.Data.SqlClient` package.

#### New behavior

`Microsoft.Extensions.Caching.SqlServer` is now using the `Microsoft.Data.SqlClient` package.

#### Reason for change

`Microsoft.Data.SqlClient` is a new package that is built off of `System.Data.SqlClient`. It's where all new feature work will be done.

#### Recommended action

Customers shouldn't need to worry about this breaking change unless they were using types returned by the `Microsoft.Extensions.Caching.SqlServer` package and casting them to `System.Data.SqlClient` types. For example, if someone was casting a `DbConnection` to the [old SqlConnection type](/dotnet/api/system.data.sqlclient.sqlconnection?view=netframework-4.8), they would need to change the cast to the new `Microsoft.Data.SqlClient.SqlConnection` type. 

#### Category

ASP.NET Core

#### Affected APIs

Not detectable via API analysis

***

### ConnectionAdapters have been removed from Kestrel

As part of the move to move "pubternal" APIs to `public`, we've removed the concept of an `IConnectionAdapter` from Kestrel. Connection adapters are being replaced with connection middleware (similar to HTTP middleware in the ASP.NET Core pipeline, but for lower-level connections). HTTPS and Connection logging have been moved from connection adapters to connection middleware so those extension methods should continue to work seamlessly (but the guts have been reimplemented).

For more information, see [aspnet/AspNetCore#11412](https://github.com/aspnet/AspNetCore/pull/11412). For discussion, see [aspnet/AspNetCore#11475](https://github.com/aspnet/AspNetCore/issues/11475).

#### Version introduced

3.0

#### Old behavior

Kestrel extensibility components were created using `IConnectionAdapter`.

#### New behavior

Kestrel extensibility components are created as [middleware](https://github.com/aspnet/AspNetCore/pull/11412/files#diff-89acc06acf1b2e96bbdb811ce523619f).

#### Reason for change

This is intended to provide a more flexible extensibility architecture.

#### Recommended action

Convert any implementations of `IConnectionAdapter` to use the new middleware pattern as shown [here](https://github.com/aspnet/AspNetCore/pull/11412/files#diff-89acc06acf1b2e96bbdb811ce523619f).

#### Category

ASP.NET Core

#### Affected APIs

[IConnectionAdapter](/dotnet/api/microsoft.aspnetcore.server.kestrel.core.adapter.internal.iconnectionadapter)

***

### SignalR JavaScript client changing package name to `@microsoft/signalr`

In ASP.NET Core 3.0 Preview 7, the SignalR JavaScript client package name changed from `@aspnet/signalr` to `@microsoft/signalr`. The name change reflects the fact that SignalR is useful in more than just ASP.NET Core apps, thanks to the Azure SignalR Service.

To react to this change, change references in your *package.json* files, `require` statements, and ECMAScript `import` statements. No API will change as part of this rename.

For discussion, see [aspnet/AspNetCore#11637](https://github.com/aspnet/AspNetCore/issues/11637).

#### Version introduced

3.0

#### Old behavior

The client package was named `@aspnet/signalr`.

#### New behavior

The client package is named `@microsoft/signalr`.

#### Reason for change

We are doing this to reflect the fact that SignalR is useful in more than just ASP.NET Core apps, thanks to the Azure SignalR Service.

#### Recommended action

Switch to the new package `@microsoft/signalr`.

#### Category

ASP.NET Core

#### Affected APIs

Not detectable via API analysis

***

### Breaking change in SignInManager constructor (new parameter)

As part of adding support for new email / confirmation flows in Identity(https://github.com/aspnet/AspNetCore/issues/8356), we added a new `IUserConfirmation<TUser>` argument to the `SignInManager` constructor.

#### Version introduced

3.0

#### Old behavior

`SignInManager` didn't require `IUserConfirmation` when constructing.

#### New behavior

`SignInManager` requires an `IUserConfirmation`.

#### Reason for change

Adding support for new email / confirmation flows

#### Recommended action

If manually constructing a `SignInManager`, provide an implementation of `IUserConfirmation` or grab one from DI to provide.

#### Category

ASP.NET Core

#### Affected APIs

[SignInManager.ctor](/dotnet/api/microsoft.aspnetcore.identity.signinmanager-1?view=aspnetcore-2.2)

***

### Breaking change in IAuthorizationPolicyProvider

As part of [aspnet/AspNetCore#9759](https://github.com/aspnet/AspNetCore/pull/9759), we added a new method to `IAuthorizationPolicyProvider.GetFallbackPolicyAsync`. This is the policy that will be used by the authorization middleware when no policy is specified.

#### Version introduced

3.0

#### Old behavior

Implementations of `IAuthorizationPolicyProvider` didn't require a `GetFallbackPolicyAsync` method.

#### New behavior

Implementations of `IAuthorizationPolicyProvider` require a `GetFallbackPolicyAsync` method.

#### Reason for change

We needed a new method for the new `AuthorizationMiddleware` to use when no policy is specified.

#### Recommended action

Add `GetFallbackPolicyAsync` method to your implementations of `IAuthorizationPolicyProvider`.

#### Category

ASP.NET Core

#### Affected APIs

[IAuthorizationPolicyProvider](/dotnet/api/microsoft.aspnetcore.authorization.iauthorizationpolicyprovider?view=aspnetcore-2.2)

***

### HttpResponse body infrastructure changes

The infrastructure backing an HTTP response body has changed. If you're using `HttpResponse` directly, you shouldn't need to make any code changes. Read further if you are wrapping or replacing `HttpResponse.Body` or accessing `HttpContext.Features`.

#### Version introduced

3.0

#### Old behavior

There were three APIs associated with the response body:

- `IHttpResponseFeature.Body`
- `IHttpSendFileFeature.SendFileAsync`
- `IHttpBufferingFeature.DisableResponseBuffering`

#### New behavior

If you replace `HttpResponse.Body`, it will replace the entire `IHttpResponseBodyFeature` with a wrapper around your given stream using `StreamResponseBodyFeature` to provide default implementations for all of the expected APIs. Setting back the original stream will undo this change.

#### Reason for change

The motivation is to consolidate the response body APIs into a single new feature interface.

#### Recommended action

Use `IHttpResponseBodyFeature` where you previously were using `IHttpResponseFeature.Body`, 
`IHttpSendFileFeature`, or `IHttpBufferingFeature`.

#### Category

ASP.NET Core

#### Affected APIs

- [IHttpResponseFeature.Body](/dotnet/api/microsoft.aspnetcore.http.features.ihttpresponsefeature.body?view=aspnetcore-2.2#Microsoft_AspNetCore_Http_Features_IHttpResponseFeature_Body)
- [IHttpSendFileFeature](/dotnet/api/microsoft.aspnetcore.http.features.ihttpsendfilefeature?view=aspnetcore-2.2)
- [IHttpBufferingFeature](/dotnet/api/microsoft.aspnetcore.http.features.ihttpbufferingfeature?view=aspnetcore-2.2)

***

### Microsoft.AspNetCore.SpaServices and Microsoft.AspNetCore.NodeServices now obsolete

The contents of the following NuGet packages have all been unnecessary since ASP.NET Core 2.1. Consequently, the packages are being marked as obsolete.

- [Microsoft.AspNetCore.SpaServices](https://www.nuget.org/packages/Microsoft.AspNetCore.SpaServices/)
- [Microsoft.AspNetCore.NodeServices](https://www.nuget.org/packages/Microsoft.AspNetCore.NodeServices/)

For the same reason, the following npm modules are being marked as deprecated:

- [aspnet-angular](https://www.npmjs.com/package/aspnet-angular)
- [aspnet-prerendering](https://www.npmjs.com/package/aspnet-prerendering)
- [aspnet-webpack](https://www.npmjs.com/package/aspnet-webpack)
- [aspnet-webpack-react](https://www.npmjs.com/package/aspnet-webpack-react)
- [domain-task](https://www.npmjs.com/package/domain-task)

The preceding packages and npm modules will later be removed in .NET 5.

#### Version introduced

3.0

#### Old behavior

The deprecated packages and npm modules were intended to integrate ASP.NET Core with various Single-Page App (SPA) frameworks. Such frameworks include Angular, React, and React with Redux.

#### New behavior

A new integration mechanism exists in the [Microsoft.AspNetCore.SpaServices.Extensions](https://www.nuget.org/packages/Microsoft.AspNetCore.SpaServices.Extensions/) NuGet package. The package remains the basis of the Angular and React project templates since ASP.NET Core 2.1.

#### Reason for change

ASP.NET Core supports integration with various Single-Page App (SPA) frameworks, including Angular, React, and React with Redux. Initially, integration with these frameworks was accomplished with ASP.NET Core-specific components that handled scenarios like server-side prerendering and integration with Webpack. As time went on, industry standards changed. Each of the SPA frameworks released their own standard command-line interfaces. For example, Angular CLI and create-react-app.

When ASP.NET Core 2.1 was released in May 2018, the team responded to the change in standards. A newer and simpler way to integrate with the SPA frameworks' own toolchains was provided. The new integration mechanism exists in the package `Microsoft.AspNetCore.SpaServices.Extensions` and remains the basis of our Angular and React project templates since ASP.NET Core 2.1.

To clarify that the older ASP.NET Core specific components aren't relevant or recommended, we're officially obsoleting the pre-2.1 integration mechanism and marking the supporting npm packages as deprecated.

#### Recommended action

If you're using these packages, update your apps to use the functionality in `Microsoft.AspNetCore.SpaServices.Extensions` instead along with the functionality provided by the SPA frameworks you're using. To enable features like server-side prerendering and hot module reload, refer to the documentation for the corresponding SPA framework. The functionality in `Microsoft.AspNetCore.SpaServices.Extensions` is *not* obsolete and will continue to be supported.

#### Category

ASP.NET Core

#### Affected APIs

- [Microsoft.AspNetCore.Builder.SpaRouteExtensions](/dotnet/api/microsoft.aspnetcore.builder.sparouteextensions?view=aspnetcore-2.2)
- [Microsoft.AspNetCore.Builder.WebpackDevMiddleware](/dotnet/api/microsoft.aspnetcore.builder.webpackdevmiddleware?view=aspnetcore-2.2)

- [Microsoft.AspNetCore.NodeServices.EmbeddedResourceReader](/dotnet/api/microsoft.aspnetcore.nodeservices.embeddedresourcereader?view=aspnetcore-2.2)
- [Microsoft.AspNetCore.NodeServices.INodeServices](/dotnet/api/microsoft.aspnetcore.nodeservices.inodeservices?view=aspnetcore-2.2)
- [Microsoft.AspNetCore.NodeServices.NodeServicesFactory](/dotnet/api/microsoft.aspnetcore.nodeservices.nodeservicesfactory?view=aspnetcore-2.2)
- [Microsoft.AspNetCore.NodeServices.NodeServicesOptions](/dotnet/api/microsoft.aspnetcore.nodeservices.nodeservicesoptions?view=aspnetcore-2.2)
- [Microsoft.AspNetCore.NodeServices.StringAsTempFile](/dotnet/api/microsoft.aspnetcore.nodeservices.stringastempfile?view=aspnetcore-2.2)
- [Microsoft.AspNetCore.NodeServices.HostingModels.INodeInstance](/dotnet/api/microsoft.aspnetcore.nodeservices.hostingmodels.inodeinstance?view=aspnetcore-2.2)
- [Microsoft.AspNetCore.NodeServices.HostingModels.NodeInvocationException](/dotnet/api/microsoft.aspnetcore.nodeservices.hostingmodels.nodeinvocationexception?view=aspnetcore-2.2)
- [Microsoft.AspNetCore.NodeServices.HostingModels.NodeInvocationInfo](/dotnet/api/microsoft.aspnetcore.nodeservices.hostingmodels.nodeinvocationinfo?view=aspnetcore-2.2)
- [Microsoft.AspNetCore.NodeServices.HostingModels.NodeServicesOptionsExtensions](/dotnet/api/microsoft.aspnetcore.nodeservices.hostingmodels.nodeservicesoptionsextensions?view=aspnetcore-2.2)
- [Microsoft.AspNetCore.NodeServices.HostingModels.OutOfProcessNodeInstance](/dotnet/api/microsoft.aspnetcore.nodeservices.hostingmodels.outofprocessnodeinstance?view=aspnetcore-2.2)

- [Microsoft.AspNetCore.SpaServices.Prerendering.ISpaPrerenderer](/dotnet/api/microsoft.aspnetcore.spaservices.prerendering.ispaprerenderer?view=aspnetcore-2.2)
- [Microsoft.AspNetCore.SpaServices.Prerendering.ISpaPrerendererBuilder](/dotnet/api/microsoft.aspnetcore.spaservices.prerendering.ispaprerendererbuilder?view=aspnetcore-2.2)
- [Microsoft.AspNetCore.SpaServices.Prerendering,JavaScriptModuleExport](/dotnet/api/microsoft.aspnetcore.spaservices.prerendering.javascriptmoduleexport?view=aspnetcore-2.2)
- [Microsoft.AspNetCore.SpaServices.Prerendering.Prerenderer](/dotnet/api/microsoft.aspnetcore.spaservices.prerendering.prerenderer?view=aspnetcore-2.2)
- [Microsoft.AspNetCore.SpaServices.Prerendering.PrerenderTagHelper](/dotnet/api/microsoft.aspnetcore.spaservices.prerendering.prerendertaghelper?view=aspnetcore-2.2)
- [Microsoft.AspNetCore.SpaServices.Prerendering.RenderToStringResult](/dotnet/api/microsoft.aspnetcore.spaservices.prerendering.rendertostringresult?view=aspnetcore-2.2)
- [Microsoft.AspNetCore.SpaServices.Webpack.WebpackDevMiddlewareOptions](/dotnet/api/microsoft.aspnetcore.spaservices.webpack.webpackdevmiddlewareoptions?view=aspnetcore-2.2)

- [Microsoft.Extensions.DependencyInjection.NodeServicesServiceCollectionExtensions](/dotnet/api/microsoft.extensions.dependencyinjection.nodeservicesservicecollectionextensions?view=aspnetcore-2.2)
- [Microsoft.Extensions.DependencyInjection.PrerenderingServiceCollectionExtensions](/dotnet/api/microsoft.extensions.dependencyinjection.prerenderingservicecollectionextensions?view=aspnetcore-2.2)

***

### ASP.NET Core Identity UI now uses "static web assets" feature

ASP.NET Core 3.0 introduced a static web assets feature, and Identity UI has adopted that new feature. As part of this move, there are a few API breaking changes to note.

Bootstrap 4 is the default UI framework for Identity UI. Bootstrap 3 has reached end of life and you should consider migrating to a supported version.

Framework selection is accomplished by using the `IdentityUIFrameworkVersion` property in your project file.

#### Version introduced

3.0

#### Old behavior

The default UI framework for Identity UI was **Bootstrap 3**. The UI framework could be configured using a parameter to the `AddIdentityUI` method call in `Startup.ConfigureServices`.

#### New behavior

The default UI framework for Identity UI is **Bootstrap 4**. The UI framework must be configured in your project file, instead of in the `AddIdentityUI` method call. Add the following MSBuild property to a `<PropertyGroup>` element in your project file:

```xml
<IdentityUIFrameworkVersion>Bootstrap3</IdentityUIFrameworkVersion>
```

#### Reason for change

The default UI framework was updated to reflect a new version of Bootstrap. Because the new static web assets feature is used, the UI framework configuration moved to MSBuild. The decision on which framework to embed is a build-time decision, not a runtime decision.

#### Recommended action

Review your site UI to ensure the new Bootstrap 4 components are compatible. If necessary, use the `IdentityUIFrameworkVersion` MSBuild property to revert to 3.

#### Category

ASP.NET Core

#### Affected APIs

[IdentityBuilderUIExtensions.AddDefaultUI()](/dotnet/api/microsoft.aspnetcore.identity.identitybuilderuiextensions.adddefaultui)

***

## Entity Framework Core

[Entity Framework Core breaking changes](/ef/core/what-is-new/ef-core-3.0/breaking-changes)
